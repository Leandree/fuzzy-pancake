<!DOCTYPE html>
<html>
<head>
	<title>chat</title>
</head>

<script src="jquery.js"></script>
<script src="ajax_refacto.js" ></script>
<script src="utils.js" ></script>

<style type="text/css">
#discussion
{
	border:1px solid black;
	height:500px;
	width:40%;
}
#message
{
	width : 40%;
}

</style>


<body>
	<label>adrese du destinataire : </label>
	<input type="text" name="adresseAmi" id="remoteURL">
</br>
</br>

<div id="discussion">


</div>
</br>
<form id="input">
	<input type="text" id="message"></input>
	<input type="submit" name="envoyer" value="Envoyer">
</form>
</body>
<script type="text/javascript">

	var localURL = "http://localhost:9876/"
	var remoteURL = "http://192.168.1.18:9876/"
	
	jQuery(document).ready(function(){
		setInterval(refresh_message, 1000);
	});

	function refresh_message()
	{
		$.ajax({
			url:localURL,
			success : function(rep){
				var data = JSON.parse(rep);

				data.forEach(function(msg){
					addMessage(msg);

				})
			}


		});
	}


	function addMessage(msg) {
		p = $("<p></p>").text(msg)
		$("#discussion").append(p)
	}

	function send() {

		var msg = $("#message").val();
		$.ajax({
			url:remoteURL,
			method:"post",
			data:JSON.stringify(msg),
			success:function() {
				console.log("Sent to "+remoteURL)
			},
			error:function() {
				console.log("Could not send message")
			}
		})
		addMessage(msg)
		$("#message").val("")
		return false
	}

	$("#input").on("submit", send)
</script>
</html>